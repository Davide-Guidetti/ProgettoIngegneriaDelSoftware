<!DOCTYPE html>
<html lang="it">
<head>
	<title>AZUDU</title>
	<meta charset="utf-8">

	<!-- script for usage of bootstrap, with jquery-->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

	<style>
	.tooltip-inner {
		background-color: #FF0000; 
		color: #FFFFFF; 
		border: 1px solid black; 
		padding: 5px;
		font-size: 15px;
	 }
	</style>
	
	<script>
		var defineTable;

		var noApprove = []; 
		var defineNoApproveTable;
		
		var competenzeNoApprove= []; 
		var defineCompetenzeNoApproveTable;

		var approve = []; 
		var defineApproveTable;
		
		var competenzeApprove= []; 
		var defineCompetenzeApproveTable;
		
		function volontari(){
			$.ajax({
				url: "/MyTemplate/servletcontroller", //server per richiedere la lista di competenze presenti
				async: false, //non rende asincrona la richiesta, in questo modo si caricano correttamente le competenze
				type: 'post',
				data: {
					comitato: "Bologna",
				},
				success: function(Obj){
					console.log(Obj);
					Obj = JSON.parse(Obj);
					for ( var a=0, b=Obj.length;  a<b;  a++ ) {
						if (Obj[a].isApprove=="true"){
							console.log("true");
							console.log(Obj[a].email);
							console.log(Obj[a].competenze);
							approve.push(Obj[a].email);
							competenzeApprove.push(Obj[a].competenze);
						}else{
							console.log("false");
							console.log(Obj[a].email);
							console.log(Obj[a].competenze);
							noApprove.push(Obj[a].email);
							competenzeNoApprove.push(Obj[a].competenze);
						}
					}
					
				}
			});
		}
		volontari();
		
		function aggiornaVolontari(){
			noApprove = defineTable.defineNoApproveTable;
			approve = defineTable.defineApproveTable;
			$.ajax({
				url: "/MyTemplate/servletcontroller", //server per richiedere la lista di competenze presenti
				async: false, //non rende asincrona la richiesta, in questo modo si caricano correttamente le competenze
				type: 'post',
				data: {
					noApprove : JSON.stringify(noApprove),
					approve : JSON.stringify(approve)
				},
				success: function(Obj){
					Obj = JSON.parse(Obj);
					console.log(Obj);
					$("#successDisplay").text("Invio avvenuto correttamente");
				}
			});
		}

		
		//function definition table
		function DefineTable(jqeryHtmlContainerNoApprove,noApprove,jqeryHtmlContainerApprove, approve, competenzeNoApprove, competenzeApprove){
			this.defineNoApproveTable = noApprove;
			this.jqeryHtmlContainerNoApprove = jqeryHtmlContainerNoApprove;
			this.defineApproveTable = approve;
			this.jqeryHtmlContainerApprove = jqeryHtmlContainerApprove;
			
			this.defineCompetenzeApproveTable = competenzeApprove;
			this.defineCompetenzeNoApproveTable = competenzeNoApprove;
			
			//promote an element
			this.approveFunction = function(index){
				$("#successDisplay").text("");
				//--------------------------------------------------------------------------------------------------------------------------------
				let newDefineNoApproveTable = [];
				let newDefineCompetenzeNoApproveTable = [];
				for(let i=0; i<this.defineNoApproveTable.length; i++){
					if(i!=index) {
						newDefineNoApproveTable.push(this.defineNoApproveTable[i]);
						newDefineCompetenzeNoApproveTable.push(this.defineCompetenzeNoApproveTable[i]);
					}
					else{
						this.defineApproveTable.push(this.defineNoApproveTable[i]);
						this.defineCompetenzeApproveTable.push(this.defineCompetenzeNoApproveTable[i]);
					}
				}
				this.defineNoApproveTable = newDefineNoApproveTable;
				this.defineCompetenzeNoApproveTable = newDefineCompetenzeNoApproveTable;
				this.renderNoApproveTable();
				this.renderApproveTable();
				//--------------------------------------------------------------------------------------------------------------------------------
			}
	
			//no approve an element
			this.noApproveFunction = function(index){
				//--------------------------------------------------------------------------------------------------------------------------------
				$("#successDisplay").text("");
				let newDefineApproveTable = [];
				let newDefineCompetenzeApproveTable = [];
				for(let i=0; i<this.defineApproveTable.length; i++){
					if(i!=index) {
						newDefineApproveTable.push(this.defineApproveTable[i]);
						newDefineCompetenzeApproveTable.push(this.defineCompetenzeApproveTable[i]);
					}
					else{
						this.defineNoApproveTable.push(this.defineApproveTable[i]);
						this.defineCompetenzeNoApproveTable.push(this.defineCompetenzeApproveTable[i]);
					}
				}
				this.defineApproveTable = newDefineApproveTable;
				this.defineCompetenzeApproveTable = newDefineCompetenzeApproveTable;
				this.renderNoApproveTable();
				this.renderApproveTable();
				//--------------------------------------------------------------------------------------------------------------------------------
			}

			//displays the list of elements in table
			this.renderNoApproveTable = function(){		
				let table = $('<table class="col-lg-10 col-sm-6">');
				let row;
				table.append($('<tr>').html('<th>Email volontari da approvare</th><th>Competenze</th><th>Azione</th>'));
				
				console.log("No approve:");
				for(let i=0; i<this.defineNoApproveTable.length; i++){
					console.log(this.defineNoApproveTable[i]);
					row = $('<tr>').attr("elementRowIndex", i);
					let promoteBtn = $('<button type="button" class="btn btn-secondary btn-success btn-sm mr-1" onClick="defineTable.approveFunction(' + i + ')">Approva</button>');
					row.append($('<td>').text(this.defineNoApproveTable[i]));
					row.append($('<td>').text(this.defineCompetenzeNoApproveTable[i]));
					row.append($('<td>').append(promoteBtn));
					table.append(row);
				}

				this.jqeryHtmlContainerNoApprove.html(table);
				table.click(function(event){
					event.stopPropagation();
				});

				
			}

			//displays the list of elements in table
			this.renderApproveTable = function(){
				let table = $('<table class="col-lg-10 col-sm-6">');
				let row;
				table.append($('<tr>').html('<th>Email volontari approvati</th><th>Competenze</th><th>Azione</th>'));
				
				console.log("Approve:");
				for(let i=0; i<this.defineApproveTable.length; i++){
					console.log(this.defineApproveTable[i]);
					row = $('<tr>').attr("elementRowIndex", i);
					let downgradeBtn = $('<button type="button" class="btn btn-secondary btn-danger btn-sm mr-1" onClick="defineTable.noApproveFunction(' + i + ')">espelli</button>');
					row.append($('<td>').text(this.defineApproveTable[i]));
					row.append($('<td>').text(this.defineCompetenzeApproveTable[i]));
					row.append($('<td>').append(downgradeBtn));
					table.append(row);
				}

				this.jqeryHtmlContainerApprove.html(table);
				table.click(function(event){
					event.stopPropagation();
				});
				
			}
		}
		
		
		//define table
		$(document).ready(function(){
			
			//comitato del coordinatore
			$("#Comitato").html("<h2><b>COMITATO BOLOGNA</b></h2>");

			//deinisco le liste dei volontari e dei coordinatori
			defineTable = new DefineTable($("#NoApproveTableCont"),noApprove,$("#ApproveTableCont"),approve,competenzeNoApprove,competenzeApprove);
			defineTable.renderNoApproveTable();
			defineTable.renderApproveTable();

			$("#Management").submit(function(e){
				noApprove = defineTable.defineNoApproveTable;
				approve = defineTable.defineApproveTable;

				
				sendNewList(noApprove);
				sendNewList(approve);
				e.preventDefault();
				return false;
			});
		});
		
	
	</script>
</head>
<body >
	<!-- Title -->
	<div class="jumbotron text-center" style="margin-bottom:0">
		<h1>AZUDU</h1>
		<!--<p></p> -->
	</div>

	<!-- navbar-->
	<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
		<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="collapsibleNavbar">
		<ul class="navbar-nav">
			<li class="nav-item">
			<a class="nav-link" href="http://localhost:8080/MyTemplate/pages/azudo/PannelloGestionePiani.html">Pannello gestione piani</a>
			</li>
			<li class="nav-item">
			<a class="navbar-brand" >Gestione volontario comitato</a>
			</li>
			<li class="nav-item">
			<a class="nav-link" href="http://localhost:8080/MyTemplate/pages/azudo/gestionePiani.html">Piani compatibili</a>
			</li>
			<li class="nav-item">
			<a class="nav-link" href="http://localhost:8080/MyTemplate/pages/azudo/listaVolontari.html">Lista volontari</a>
			</li>
		</ul>
		<ul class="navbar-nav ml-auto">
			<li class="nav-item">
			<a class="nav-link" href="http://localhost:8080/MyTemplate/pages/azudo/ModificaDati.html">Profilo</a>
		</li>
		</ul>
		</div>  
	</nav>
	<br>
	<form id="Management" class="container" style="margin-top:30px" >
		<div id="Comitato"></div>
		<br>
		<div id="NoApproveTableCont"></div>
		<br>
		<div id="ApproveTableCont"></div>
		<br>
		<input type="submit" class="btn btn-primary btn-sm mr-1" value="Applica" onclick="aggiornaVolontari()"><br>
		<p id="successDisplay" style="color:green;"></p>
	</form>
	<br>
	
	<br>
	

	<!--footer-->
	<div class="jumbotron text-center" style="margin-bottom:0">
		<h2>Footer</h2>
	</div>
	  
	
</body>
</html>